name: Release

on:
  push:
    branches:
      - main

jobs:
  release:
    uses: reuters-graphics/action-workflows/.github/workflows/changesets-release.yaml@main
    secrets: inherit
    with:
      node_version: '20'
      publish_docs: true

  notify-downstream:
    needs: release
    if: needs.release.outputs.published == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Wait for npm propagation
        run: sleep 30

      - name: Dispatch to bluprint_graphics-kit
        uses: peter-evans/repository-dispatch@v4
        with:
          token: ${{ secrets.REPO_PAT_TOKEN }}
          repository: reuters-graphics/bluprint_graphics-kit
          event-type: dependency-updated
