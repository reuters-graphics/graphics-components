{"version":3,"file":"ReferralBlock.stories-6c29a636.js","sources":["../../src/components/ReferralBlock/stories/docs/component.md?raw","../../src/components/ReferralBlock/stores.js","../../src/components/ReferralBlock/ReferralBlock.svelte","../../src/components/ReferralBlock/ReferralBlock.stories.svelte"],"sourcesContent":["export default \"The `ReferralBlock` component creates a set of referral links from recent dotcom stories using the [recent stories by section API](https://www.reuters.com/pf/api/v3/content/fetch/recent-stories-by-sections-v1?query=%7B%22section_ids%22%3A%22%2Fworld%2F%22%2C%22size%22%3A20%2C%22website%22%3A%22reuters%22%7D).\\n\\n> The `section` prop determines which section stories are from.\\n>\\n> You can get the section ID from the section page on dotcom. For example, the section ID for World - Europe stories at `www.reuters.com/world/europe/` would be `/world/europe/`. (The leading and trailing slashes are required!)\\n\\n```svelte\\n<script>\\n  import { ReferralBlock } from '@reuters-graphics/graphics-components';\\n</script>\\n\\n<ReferralBlock section=\\\"/lifestyle/sports/\\\" />\\n```\\n\"","import { writable } from 'svelte/store';\n\nexport const referrals = writable([]);\n","<!-- @component `ReferralBlock` [Read the docs.](https://reuters-graphics.github.io/graphics-components/?path=/docs/components-ReferralBlock--default) -->\n<script lang=\"ts\">\n  /** ✏️ DOCUMENT your chart's props using TypeScript and JSDoc comments like below! */\n\n  /**\n   * Section ID, which is often the URL path to the section page on reuters.com.\n   *\n   * Note that not all section pages will be available in the recent stories by section API.\n   * @required\n   */\n  export let section: string = '/world/';\n\n  /**\n   * Number of referrals to show.\n   * @required\n   */\n  export let number: number = 4;\n\n  /**\n   * Link [target](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attr-target), e.g., `_blank` or `_parent`.\n   */\n  export let linkTarget: string = '_self';\n\n  /**\n   * Add a heading to the referral block.\n   */\n  export let heading: string = '';\n\n  type ContainerWidth = 'normal' | 'wide' | 'wider' | 'widest' | 'fluid';\n\n  /**\n   * Width of the component within the text well.\n   * @required\n   */\n  export let width: ContainerWidth = 'wide';\n\n  /** Add an ID to target with SCSS. */\n  export let id: string = '';\n\n  /** Add a class to target with SCSS. */\n  let cls: string = '';\n  export { cls as class };\n\n  import Block from '../Block/Block.svelte';\n  import { referrals } from './stores.js';\n\n  import { onMount } from 'svelte';\n  import { getTime } from '../SiteHeader/NavBar/NavDropdown/StoryCard/time';\n\n  let clientWidth;\n\n  onMount(async () => {\n    try {\n      const response = await fetch(\n        'https://www.reuters.com/pf/api/v3/content/fetch/recent-stories-by-sections-v1?' +\n          new URLSearchParams({\n            query: JSON.stringify({\n              section_ids: section,\n              size: 20,\n              website: 'reuters',\n            }),\n          })\n      );\n      const articles = (await response.json()).result.articles\n        .filter((a) => a?.kicker?.name)\n        .filter((a) => a?.thumbnail?.renditions?.landscape?.['240w'])\n        .filter((a) => !a?.content?.third_party)\n        .slice(0, number);\n      referrals.set(articles);\n    } catch (e) {\n      console.warn('Unable to fetch referral links.');\n    }\n  });\n\n  getTime();\n</script>\n\n{#if $referrals.length === number}\n  <Block width=\"{width}\" id=\"{id}\" class=\"referrals-block fmy-8 {cls}\">\n    {#if heading}\n      <div\n        class=\"heading h4 font-bold\"\n        class:stacked=\"{clientWidth && clientWidth < 750}\"\n      >\n        {heading}\n      </div>\n    {/if}\n    <div\n      class=\"referral-container inline-flex flex-wrap w-full justify-between\"\n      class:stacked=\"{clientWidth && clientWidth < 750}\"\n      class:xs=\"{clientWidth && clientWidth < 450}\"\n      bind:clientWidth=\"{clientWidth}\"\n    >\n      {#each $referrals as referral}\n        <div class=\"referral\">\n          <a\n            href=\"https://www.reuters.com{referral.canonical_url}\"\n            target=\"{linkTarget}\"\n            rel=\"{linkTarget === '_blank' ? 'noreferrer' : null}\"\n          >\n            <div class=\"referral-pack flex justify-around my-0 mx-auto\">\n              <div\n                class=\"headline\"\n                class:xs=\"{clientWidth && clientWidth < 450}\"\n              >\n                <div class=\"kicker m-0 body-caption\" data-chromatic=\"ignore\">\n                  {referral.kicker.name}\n                </div>\n                <div class=\"title m-0 body-caption\" data-chromatic=\"ignore\">\n                  {referral.title}\n                </div>\n                <div class=\"publish-time body-caption\" data-chromatic=\"ignore\">\n                  {getTime(new Date(referral.display_time))}\n                </div>\n              </div>\n              <div\n                class=\"image-container block m-0 overflow-hidden relative\"\n                class:xs=\"{clientWidth && clientWidth < 450}\"\n              >\n                <img\n                  class=\"block object-cover m-0 w-full\"\n                  data-chromatic=\"ignore\"\n                  src=\"{referral.thumbnail.renditions.landscape['240w']}\"\n                  alt=\"{referral.thumbnail.caption ||\n                    referral.thumbnail.alt_text}\"\n                />\n              </div>\n            </div>\n          </a>\n        </div>\n      {/each}\n    </div>\n  </Block>\n{/if}\n\n<style lang=\"scss\">\n  @use '../../scss/mixins' as *;\n\n  div.heading {\n    &.stacked {\n      max-width: 450px;\n    }\n  }\n\n  .referral-container {\n    a {\n      text-decoration: none;\n    }\n    &.stacked {\n      .referral {\n        width: 100%;\n        .headline {\n          width: calc(100% - 7rem);\n        }\n      }\n    }\n    .referral {\n      display: block;\n      width: calc(50% - 30px);\n      max-width: 450px;\n      @include fmy-1;\n\n      &:hover {\n        .title {\n          text-decoration: underline;\n        }\n        img {\n          filter: brightness(85%);\n        }\n      }\n\n      .headline {\n        display: inline-block;\n        width: calc(100% - 9rem);\n        @include fpr-2;\n        &.xs {\n        }\n        .kicker {\n          @include text-xxs;\n        }\n        .title {\n          @include font-medium;\n          @include text-sm;\n          @include text-primary;\n        }\n        .publish-time {\n          @include text-xxs;\n        }\n      }\n      .image-container {\n        border-radius: 0.25rem;\n        border: 1px solid $theme-colour-brand-rules;\n        width: 9rem;\n        &.xs {\n          width: 7rem;\n        }\n        img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          transition: filter 0.1s;\n        }\n      }\n    }\n  }\n</style>\n","<script>\n  import { Meta, Template, Story } from '@storybook/addon-svelte-csf';\n\n  // @ts-ignore\n  import componentDocs from './stories/docs/component.md?raw';\n\n  import ReferralBlock from './ReferralBlock.svelte';\n\n  import { withComponentDocs } from '$docs/utils/withParams.js';\n\n  const metaProps = {\n    ...withComponentDocs(componentDocs),\n    argTypes: {\n      width: {\n        control: 'select',\n        options: ['normal', 'wide', 'wider', 'widest', 'fluid'],\n      },\n      section: {\n        control: 'select',\n        options: [\n          '/world/',\n          '/world/europe/',\n          '/lifestyle/',\n          '/lifestyle/sports/',\n          '/legal/',\n          '/business/',\n          '/business/energy/',\n        ],\n      },\n      number: {\n        control: 'select',\n        options: [2, 4, 6, 8],\n      },\n    },\n  };\n</script>\n\n<Meta\n  title=\"Components/ReferralBlock\"\n  component=\"{ReferralBlock}\"\n  {...metaProps}\n/>\n\n<Template let:args>\n  <ReferralBlock {...args} />\n</Template>\n\n<Story\n  name=\"Default\"\n  args=\"{{\n    section: '/lifestyle/sports/',\n    number: 4,\n    class: 'fmy-5',\n    heading: 'More World Cup coverage',\n  }}\"\n/>\n"],"names":["componentDocs","referrals","writable","ctx","insert","target","div","anchor","t2_value","t4_value","getTime","src_url_equal","img","img_src_value","attr","a","a_href_value","a_rel_value","div6","append","div5","div3","div0","div1","div2","div4","set_data","t0","t0_value","dirty","t2","t4","create_if_block_1","i","create_if_block","section","$$props","number","linkTarget","heading","width","id","cls","clientWidth","onMount","articles","_a","_c","_b","ReferralBlock","withComponentDocs"],"mappings":"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"}