{"version":3,"file":"Analytics.stories-595852fc.js","sources":["../../src/components/Analytics/stories/docs/component.md?raw","../../src/components/Analytics/stories/docs/environments.md?raw","../../src/components/Analytics/stories/docs/multipage.md?raw","../../src/components/Analytics/providers/ga.ts","../../src/components/Analytics/providers/chartbeat.ts","../../src/components/Analytics/Analytics.svelte","../../src/components/Analytics/Analytics.stories.svelte"],"sourcesContent":["export default \"Add Google and Chartbeat analytics to your page.\\n\\n```svelte\\n<script>\\n  import { Analytics } from '@reuters-graphics/graphics-components';\\n\\n  const authors = [{ name: 'Jane Doe' }, { name: 'John Doe' }];\\n</script>\\n\\n<Analytics authors=\\\"{authors}\\\" />\\n```\\n\"","export default \"Generally, you only want to send page analytics in production environments.\\n\\nIn a SvelteKit context, you can use `$app` stores to restrict when you send analytics.\\n\\nFor example, the following excludes analytics from pages in development or hosted on our preview server:\\n\\n```svelte\\n<script>\\n  import { Analytics } from '@reuters-graphics/graphics-components';\\n  import { dev } from '$app/environment';\\n  import { page } from '$app/stores';\\n</script>\\n\\n{#if !dev && $page.url?.hostname !== 'graphics.thomsonreuters.com'}\\n  <Analytics />\\n{/if}\\n```\\n\"","export default \"If you're using analytics to measure a multipage newsapp that uses [client-side routing](https://kit.svelte.dev/docs/glossary#routing), then you may need to trigger analytics after virtual page navigation.\\n\\nThis component also exports a function you can call to register pageviews.\\n\\nFor example, here's how you can use SvelteKit's [`afterNavigate`](https://kit.svelte.dev/docs/modules#$app-navigation-afternavigate) lifecycle to capture additional pageviews:\\n\\n```svelte\\n<script>\\n  import {\\n    Analytics,\\n    registerPageview,\\n  } from '@reuters-graphics/graphics-components';\\n  import { afterNavigate } from '$app/navigation';\\n  import { onMount } from 'svelte';\\n\\n  let hasMounted = false;\\n\\n  onMount(() => {\\n    hasMounted = true;\\n  });\\n\\n  afterNavigate(() => {\\n    // We shouldn't fire on initial page load because the Analytics component\\n    // already registers a reader's first pageview. After this component\\n    // has mounted, we can be sure that further navigation is virtual and\\n    // register pageviews using this function.\\n    if (hasMounted) registerPageview();\\n  });\\n</script>\\n\\n<Analytics />\\n```\\n\"","// Reuters Google Tag ID\nconst GOOGLE_TAG_ID = 'G-W3Q2X6NTNM';\n\nconst URL = `https://www.googletagmanager.com/gtag/js?id=${GOOGLE_TAG_ID}`;\n\nconst attachScript = () => {\n  // If script is already attached, skip\n  if (document.querySelector(`script[src=\"${URL}\"]`)) return;\n  // ... else attach it.\n  const e = document.createElement('script');\n  const n = document.getElementsByTagName('script')[0];\n  e.type = 'text/javascript';\n  e.async = true;\n  e.src = URL;\n  n.parentNode.insertBefore(e, n);\n};\n\nexport default () => {\n  try {\n    window.dataLayer = window.dataLayer || [];\n    if (!window.gtag) {\n      attachScript();\n      /** @type {Gtag.Gtag} */\n      window.gtag = function() {\n        window.dataLayer.push(arguments);\n      };\n      window.gtag('js', new Date());\n      // config event registers a pageview by default\n      window.gtag('config', GOOGLE_TAG_ID, {\n        send_page_view: false,\n      });\n      registerPageview();\n    }\n  } catch (e) { console.warn(`Error initialising Google Analytics: ${e}`); }\n};\n\nexport const registerPageview = () => {\n  if (typeof window === 'undefined' || !window.gtag) return;\n  window.gtag('event', 'page_view', {\n    page_location: window.location.origin + window.location.pathname,\n    page_title: document?.title,\n  });\n};\n","// Reuters Chartbeat UID\nconst UID = 52639;\n\nconst URL = '//static.chartbeat.com/js/chartbeat.js';\n\nconst attachScript = () => {\n  // If script is already attached, skip\n  if (document.querySelector(`script[src=\"${URL}\"]`)) return;\n  // ... else attach it.\n  const e = document.createElement('script');\n  const n = document.getElementsByTagName('script')[0];\n  e.type = 'text/javascript';\n  e.async = true;\n  e.src = URL;\n  n.parentNode.insertBefore(e, n);\n};\n\nexport default (authors: { name: string }[]) => {\n  window._sf_async_config = {\n    uid: UID,\n    domain: 'reuters.com',\n    flickerControl: false,\n    useCanonical: true,\n    useCanonicalDomain: true,\n    sections: 'Graphics',\n    authors: authors.map((a) => a?.name || '').join(','),\n    ...(window._sf_async_config || {}),\n  };\n\n  try {\n    attachScript();\n  } catch (e) { console.warn(`Error initialising Chartbeat Analytics: ${e}`); }\n};\n\nexport const registerPageview = () => {\n  if (typeof window === 'undefined' || !window.pSUPERFLY) return;\n  window.pSUPERFLY({\n    path: window.location.pathname,\n    title: document?.title,\n  });\n};\n","<script context=\"module\">\n  import { registerPageview as registerChartbeatPageview } from './providers/chartbeat';\n  import { registerPageview as registerGAPageview } from './providers/ga';\n\n  /** Register virtual pageviews when using client-side routing in multipage applications. */\n  export function registerPageview() {\n    registerChartbeatPageview();\n    registerGAPageview();\n  }\n</script>\n\n<!-- @component `Analytics` [Read the docs.](https://reuters-graphics.github.io/graphics-components/?path=/docs/components-Analytics--default) -->\n<script lang=\"ts\">\n  interface Author {\n    name: string;\n  }\n  /**\n   * Used to associate a page with its author(s) in Chartbeat.\n   */\n  export let authors: Author[] = [];\n\n  import { onMount } from 'svelte';\n  import { ga, chartbeat } from './providers';\n\n  onMount(() => {\n    ga();\n    chartbeat(authors);\n  });\n</script>\n","<script>\n  import { Meta, Template, Story } from '@storybook/addon-svelte-csf';\n\n  // Don't lose the \"?raw\" in markdown imports!\n  // @ts-ignore\n  import componentDocs from './stories/docs/component.md?raw';\n  // @ts-ignore\n  import environmentsDocs from './stories/docs/environments.md?raw';\n  // @ts-ignore\n  import multipageDocs from './stories/docs/multipage.md?raw';\n\n  import Analytics from './Analytics.svelte';\n\n  import { withComponentDocs, withStoryDocs } from '$docs/utils/withParams.js';\n</script>\n\n<Meta\n  title=\"Components/Analytics\"\n  component=\"{Analytics}\"\n  {...withComponentDocs(componentDocs)}\n/>\n\n<Template let:args>\n  <Analytics {...args} />\n  <div>Nothing to see here</div>\n</Template>\n\n<Story\n  name=\"Default\"\n  args=\"{{\n    authors: [{ name: 'Jane Doe' }, { name: 'John Doe' }],\n  }}\"\n/>\n\n<Story name=\"Environments\" {...withStoryDocs(environmentsDocs)}>\n  <Analytics />\n  <div>Nothing to see here</div>\n</Story>\n\n<Story name=\"Multipage apps\" {...withStoryDocs(multipageDocs)}>\n  <Analytics />\n  <div>Nothing to see here</div>\n</Story>\n"],"names":["componentDocs","environmentsDocs","multipageDocs","GOOGLE_TAG_ID","URL","attachScript","e","n","ga","registerPageview","UID","chartbeat","authors","a","$$props","onMount","ctx","insert","target","div","anchor","Analytics","withComponentDocs","story1_spread_levels","withStoryDocs","story2_spread_levels"],"mappings":"qTAAA,MAAeA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAAC,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAAC,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECCTC,EAAgB,eAEhBC,EAAM,+CAA+CD,CAAa,GAElEE,GAAe,IAAM,CAEzB,GAAI,SAAS,cAAc,eAAeD,CAAG,IAAI,EAAG,OAE9C,MAAAE,EAAI,SAAS,cAAc,QAAQ,EACnCC,EAAI,SAAS,qBAAqB,QAAQ,EAAE,CAAC,EACnDD,EAAE,KAAO,kBACTA,EAAE,MAAQ,GACVA,EAAE,IAAMF,EACNG,EAAA,WAAW,aAAaD,EAAGC,CAAC,CAChC,EAEAC,GAAe,IAAM,CACf,GAAA,CACK,OAAA,UAAY,OAAO,WAAa,CAAA,EAClC,OAAO,OACGH,KAEb,OAAO,KAAO,UAAW,CAChB,OAAA,UAAU,KAAK,SAAS,CAAA,EAEjC,OAAO,KAAK,KAAU,IAAA,IAAM,EAErB,OAAA,KAAK,SAAUF,EAAe,CACnC,eAAgB,EAAA,CACjB,EACgBM,YAEZH,EAAG,CAAU,QAAA,KAAK,wCAAwCA,CAAC,EAAE,CAAG,CAC3E,EAEaG,GAAmB,IAAM,CAChC,OAAO,OAAW,KAAe,CAAC,OAAO,MACtC,OAAA,KAAK,QAAS,YAAa,CAChC,cAAe,OAAO,SAAS,OAAS,OAAO,SAAS,SACxD,WAAY,+BAAU,KAAA,CACvB,CACH,ECzCMC,GAAM,MAENN,EAAM,yCAENC,GAAe,IAAM,CAEzB,GAAI,SAAS,cAAc,eAAeD,CAAG,IAAI,EAAG,OAE9C,MAAAE,EAAI,SAAS,cAAc,QAAQ,EACnCC,EAAI,SAAS,qBAAqB,QAAQ,EAAE,CAAC,EACnDD,EAAE,KAAO,kBACTA,EAAE,MAAQ,GACVA,EAAE,IAAMF,EACNG,EAAA,WAAW,aAAaD,EAAGC,CAAC,CAChC,EAEeI,GAACC,GAAgC,CAC9C,OAAO,iBAAmB,CACxB,IAAKF,GACL,OAAQ,cACR,eAAgB,GAChB,aAAc,GACd,mBAAoB,GACpB,SAAU,WACV,QAASE,EAAQ,IAAKC,IAAMA,GAAA,YAAAA,EAAG,OAAQ,EAAE,EAAE,KAAK,GAAG,EACnD,GAAI,OAAO,kBAAoB,CAAC,CAAA,EAG9B,GAAA,CACWR,WACNC,EAAG,CAAU,QAAA,KAAK,2CAA2CA,CAAC,EAAE,CAAG,CAC9E,yBCba,QAAAM,EAAO,EAAA,EAAAE,EAKlB,OAAAC,EAAO,IAAA,CACLP,KACAG,GAAUC,CAAO,mqBCHJI,EAAI,CAAA,CAAA,kLACnBC,EAA6BC,EAAAC,EAAAC,CAAA,kCADdJ,EAAI,CAAA,CAAA,CAAA,CAAA,iQAanBC,EAA6BC,EAAAC,EAAAC,CAAA,6PAK7BH,EAA6BC,EAAAC,EAAAC,CAAA,oMAvBjBC,CAAS,EACjBC,EAAkBtB,CAAa,4MAWjC,UAAY,KAAM,UAAgB,EAAA,CAAA,KAAM,WAAU,MAIvB,MAAAuB,EAAA,CAAA,CAAA,KAAA,cAAA,EAAAC,EAAcvB,CAAgB,CAAA,4GAK5B,MAAAwB,EAAA,CAAA,CAAA,KAAA,gBAAA,EAAAD,EAActB,CAAa,CAAA;;;"}